# 使用量トラッキング機能

## 概要
ユーザーごとのAPI使用量とコストを追跡する機能です。

## 現在の実装状況

### 実装済み
- Gemini API呼び出し回数の記録
- 使用量表示UI（ヘッダーの棒グラフアイコン）
- 月別の使用量集計
- 推定コスト計算

### 制限事項
- Firestore操作の追跡は現在無効化されています
- クライアントサイドでの実装のため、セキュリティ上の制限があります

## 推奨される実装方法

### Cloud Functionsを使用した実装
本来、使用量トラッキングはサーバーサイドで実装すべきです：

1. **Firestore Triggers**
   - onCreate/onUpdate/onDeleteトリガーで操作を検知
   - user_usageコレクションを自動更新

2. **API Proxy**
   - Gemini APIへのリクエストをCloud Functions経由にする
   - 使用量を自動記録

### セキュリティ
現在のセキュリティルールでは、ユーザーは自分の使用量データのみアクセス可能です。

## コスト計算

### Gemini API
- 概算: $0.000001/呼び出し
- 実際の料金はGoogle Cloud Consoleで確認してください

### Firestore（無料枠）
- 読み取り: 50,000回/日
- 書き込み: 20,000回/日
- 削除: 20,000回/日
- ストレージ: 1GB

無料枠を超えた場合：
- 読み取り: $0.06 per 100,000
- 書き込み: $0.18 per 100,000
- 削除: $0.02 per 100,000